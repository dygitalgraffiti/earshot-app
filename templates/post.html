{% extends "layout.html" %}
{% block title %}New Post{% endblock %}
{% block content %}
<h2>Share a Track</h2>
<form id="post-form">
  <input type="url" name="url" placeholder="Spotify / YouTube / Apple Music URL" required style="width:100%;padding:8px;">
  <button type="submit" style="margin-top:8px;">Post</button>
</form>
<script>
document.getElementById('post-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const url = e.target.url.value;
  const resp = await fetch('/post', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({url})
  });
  const data = await resp.json();
  if (data.success) location.href = data.redirect;
  else alert(data.error);
});
</script>
{% endblock %}
