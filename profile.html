<!DOCTYPE html>
<html>
<head>
  <script src="https://cdn.tailwindcss.com"></script>
  <title>@{{ profile_user.username }}</title>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-md mx-auto bg-white min-h-screen">
    <div class="p-4 border-b flex justify-between items-center">
      <a href="/" class="text-green-600 text-lg">&larr;</a>
      <h1 class="text-xl font-bold">@{{ profile_user.username }}</h1>
      {% if current_user and profile_user.id != current_user.id %}
        {% if is_following %}
          <span class="text-gray-500 text-sm">Following</span>
        {% else %}
          <a href="/follow/{{ profile_user.id }}" class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">Follow</a>
        {% endif %}
      {% endif %}
    </div>

    <div class="p-4 space-y-4">
      {% for post in posts %}
        <div class="max-w-xs px-4 py-2 rounded-2xl bg-green-500 text-white ml-auto">
          <div class="flex items-start space-x-3">
            <img src="{{ post.thumbnail }}" class="w-12 h-12 rounded-lg object-cover">
            <div class="flex-1 min-w-0">
              <p class="font-medium truncate">{{ post.title }}</p>
              <p class="text-sm opacity-80 truncate">{{ post.artist }}</p>
            </div>
            <button onclick="play(this)" data-embed="{{ post.embed_url }}"
                    class="w-8 h-8 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
            </button>
          </div>
          <div class="hidden mt-2 player-container w-full"></div>
          <p class="text-xs opacity-60 mt-2 text-right">Â· {{ post.timestamp.strftime('%H:%M') }}</p>
        </div>
      {% else %}
        <p class="text-center text-gray-500">No posts yet.</p>
      {% endfor %}
    </div>
  </div>

  <script>
  function play(btn) {
    const container = btn.closest('div').querySelector('.player-container');
    const url = btn.getAttribute('data-embed');
    if (container.classList.contains('hidden')) {
      const iframe = document.createElement('iframe');
      iframe.src = url + (url.includes('?') ? '&' : '?') + 'origin=' + location.origin;
      iframe.className = 'w-full h-20 rounded-lg';
      iframe.frameBorder = '0';
      iframe.allow = 'encrypted-media; autoplay';
      container.appendChild(iframe);
      container.classList.remove('hidden');
    } else {
      container.innerHTML = '';
      container.classList.add('hidden');
    }
  }
  </script>
</body>
</html>